<%= render 'client' %>

<script>

  // template sources

  var todoItemsTemplate = $('[data-todo-items-template]').html();

  var todoItemTemplate = $('[data-todo-item-template]').html();

  // mock todo data

  var todoItems = {
    complete: [{title: "a"}, {title: "b"}],
    incomplete: [{title: "c"}, {title: "d"}],
    in_progress: [{title: "e"}, {title: "f"}]
  }

  // render helpers

  var renderTodoItem = function(todoListItem) {
    return Mustache.render(todoItemTemplate, todoListItem);
  }

  var renderTodoItems = function(todoItems) {
    return Mustache.render(todoItemsTemplate, {
      todoItems: _.map(todoItems, renderTodoItem).join('')
    });
  }

  // mock list data

  // views

  var TodoListsView = Backbone.View.extend({

    render: function() {
      var listsData = [{
        name: "Our list name!!",
        id: 1,
        completedTodoItems: renderTodoItems(todoItems.complete),
        wipTodoItems: renderTodoItems(todoItems.incomplete),
        incompleteTodoItems: renderTodoItems(todoItems.in_progress)
      }];

      this.$el.html(this.renderLists(listsData));
    },

    renderLists: function(listsData) {
      var _this = this;
      return _.map(listsData, function(listData){
        return Mustache.render(_this.todoListTemplate, listData);
      }).join('');
    },

    todoListTemplate: $('[data-todo-list-template]').html()

  });

  window.app = {};

  app.todoListView = new TodoListsView({el: $('.todo-lists')});
  app.todoListView.render();

  $('body').removeClass('loading');

</script>
